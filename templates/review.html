{% extends 'base.html' %}
{% block content %}
  <h4>レビュー：データセット #{{ dataset.id }}</h4>
  <p>
    <strong>店舗名:</strong> {{ dataset.shop_name }}<br/>
    <strong>住所:</strong> {{ dataset.address }}<br/>
    <strong>公式ホームページ:</strong><br/>
    <textarea rows="2" readonly style="width:100%; max-width:600px;">{{ dataset.homepage_url or '' }}</textarea><br/>
    <strong>概要:</strong> {{ dataset.summary or '-' }}<br/>
    <strong>代表者名:</strong> {{ dataset.top_name or '-' }}<br/>
    <strong>営業時間:</strong> {{ dataset.time or '-' }}<br/>
    <strong>定休日:</strong> {{ dataset.day or '-' }}<br/>
    <strong>次回コール日程:</strong> {{ dataset.next_call_date or '-' }}<br/>
    <strong>次回コール時間:</strong> {{ dataset.next_call_time or '-' }}<br/>
    <strong>CSV:</strong>
    {% if dataset.csv_name %}
      <a href="{{ url_for('main.dataset_csv', dataset_id=dataset.id) }}">{{ dataset.csv_name }}</a>
    {% else %}
      -
    {% endif %}<br/>
    <span class="muted">作成日時: {{ dataset.created_at }}</span>
  </p>

  {% if calls %}
  <div style="overflow:auto">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>開始ユーザータイプ</th>
          <th>通話相手</th>
          <th>通話フロー</th>
          <th>発信者番号</th>
        </tr>
      </thead>
      <tbody>
        {% for r in calls %}
        <tr>
          <td>{{ r.id }}</td>
          <td>{{ r.start_user_type }}</td>
          <td>{{ r.callee }}</td>
          <td>{{ r.call_flow or '-' }}</td>
          <td>{{ r.caller_number }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p>このデータセットには行がありません。</p>
  {% endif %}

  <div class="actions" style="margin-top: 1rem">
    <form class="inline" method="post" action="{{ url_for('main.update_summary', dataset_id=dataset.id) }}" style="display:block; margin-bottom: 0.5rem;">
      <textarea name="summary" rows="4" style="width:100%; max-width:600px;" placeholder="概要を編集">{{ dataset.summary or '' }}</textarea>
      <br/>
      <button type="submit">概要を保存</button>
    </form>
    <form class="inline" method="post" action="{{ url_for('main.mark_prospect', dataset_id=dataset.id) }}">
      <button type="submit">見込み</button>
    </form>
    <form class="inline" method="post" action="{{ url_for('main.discard_dataset', dataset_id=dataset.id) }}" onsubmit="return confirm('このデータセットを削除しますか？');">
      <button type="submit">捨てる</button>
    </form>
    <a class="button" href="{{ url_for('main.review', after=dataset.id) }}">次へ</a>
  </div>
{% endblock %}
